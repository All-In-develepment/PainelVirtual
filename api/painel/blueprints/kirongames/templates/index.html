{% extends "layouts/app.html" %}

{% block title %}Jogos Estrela Bet{% endblock %}

{% block body %}
	<div class="row">
		<center>
			<a href="#" onclick="selectCampeonato('1')">
					<img src="{{ url_for('static', filename='images/flags/italy.png') }}" alt="flag italiano" width="60" />
			</a>
			<a href="#" onclick="selectCampeonato('2')">
					<img src="{{ url_for('static', filename='images/flags/england.png') }}" alt="flag inglês" width="60" />
			</a>
			<a href="#" onclick="selectCampeonato('3')">
					<img src="{{ url_for('static', filename='images/flags/spain.png') }}" alt="flag espanhol" width="60" />
			</a>
		</center>
			<div>
				<form id="paramForm">
					<label for="mercado">Mercado:</label>
					<select id="mercado" name="mercado" onchange="updateParams()">
							<optgroup label="Over" style="font-weight: bold;">
								<option value="over0_5">Over 0.5</option>
								<option value="over1_5">Over 1.5</option>
								<option value="over2_5" selected>Over 2.5</option>
								<option value="over3_5">Over 3.5</option>
							</optgroup>
							<optgroup label="Under" style="font-weight: bold;">
								<option value="under0_5">Under 0.5</option>
								<option value="under1_5">Under 1.5</option>
								<option value="under2_5">Under 2.5</option>
								<option value="under3_5">Under 3.5</option>
							</optgroup>
							<optgroup label="Ambas Marcam" style="font-weight: bold;">
									<option value="ambas_marcam_sim">Ambas Marcam: Sim</option>
									<option value="ambas_marcam_nao">Ambas Marcam: Não</option>
							</optgroup>
							<optgroup label="Par ou Ímpar" style="font-weight: bold;">
									<option value="par">Par</option>
									<option value="impar">Ímpar</option>
							</optgroup>
					</select>
				</form>
			</div>
			
			<label for="periodo">Período (horas):</label>
			<select id="periodo" name="periodo" onchange="updateParams()">
					<option value="3">3 horas</option>
					<option value="6">6 horas</option>
					<option value="9">9 horas</option>
					<option value="12">12 horas</option>
					<option value="24" selected>24 horas</option>
			</select>
			<br>
			<label for="campeonato">Campeonato:</label>
			<select id="campeonato" name="campeonato" onchange="updateParams()">
					<option value="1">Italiano</option>
					<option value="2">Inglês</option>
					<option value="3">Espanhol</option>
			</select>
	</form>
	<br>

	<div style="text-align: right;">
    <button id="openModalButton" class="btn btn-primary" onclick="openModal()">
        Busca Automática de Padrões para Tiro Seco
    </button>
	</div>

	<!-- MODAL -->
	<div id="ligaModal" class="modal" style="display: none;">
		<div class="modal-content">
			<span class="close" id="closeModalButton">&times;</span>
			<h2 id="head-busca"></h2>
			<div id="tabelas">
				<div>
					<h4 id="leagueId">Italiano</h4>
					<table class="table">
						<thead>
						<tr>
							<th>Placar</th>
							<th>S/Gale</th>
							<th>1º Gale</th>
							<th>2º Gale</th>
							<th>Reds</th>
							<th>Green</th>
							<th>%</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td>1</td>
							<td>Juventus</td>
							<td>75</td>
						</tr>
					</tbody>
				</table>
			</div>
					<h4>Inglês</h4>
					<table class="table">
							<thead>
									<tr>
											<th>#</th>
											<th>Time</th>
											<th>Pontos</th>
									</tr>
							</thead>
							<tbody>
									<tr>
											<td>1</td>
											<td>Manchester City</td>
											<td>80</td>
									</tr>
							</tbody>
					</table>
					<h4>Espanhol</h4>
					<table class="table">
							<thead>
									<tr>
											<th>#</th>
											<th>Time</th>
											<th>Pontos</th>
									</tr>
							</thead>
							<tbody>
									<tr>
											<td>1</td>
											<td>Real Madrid</td>
											<td>78</td>
									</tr>
							</tbody>
					</table>
				</div>
		</div>
	</div>

	{% if games != 0 %}
	<table class="table">
			<thead>
					<tr>
							<th></th>
							{% for minutos in games['Minutos'] %}
									<th style="text-align: center">{{ minutos['Numero'] }}</th>
							{% endfor %}
					</tr>
			</thead>
			<tbody class="row">
				{% for linha in games['Linhas'] %}
						<tr>
								<td>{{ linha['Hora'] }}</td>
								{% for coluna in linha['Colunas'] %}
										{% if 'SomaGols' in coluna %}
												{% if mercado.startswith('under') %}
														{% if mercado == 'under0_5' %}
																{% if coluna['SomaGolsUnder0_5'] < 0.5 %}
																		<td style="text-align: center" class="bg-success">  
																				{{ coluna['Resultado']|replace('+', '') }}
																		</td>
																{% else %}
																		<td style="text-align: center" class="bg-danger">  
																				{{ coluna['Resultado']|replace('+', '') }}
																		</td>
																{% endif %}
														{% elif mercado == 'under1_5' %}
																{% if coluna['SomaGolsUnder1_5'] < 1.5 %}
																		<td style="text-align: center" class="bg-success">  
																				{{ coluna['Resultado']|replace('+', '') }}
																		</td>
																{% else %}
																		<td style="text-align: center" class="bg-danger">  
																				{{ coluna['Resultado']|replace('+', '') }}
																		</td>
																{% endif %}
														{% elif mercado == 'under2_5' %}
																{% if coluna['SomaGolsUnder2_5'] < 2.5 %}
																		<td style="text-align: center" class="bg-success">  
																				{{ coluna['Resultado']|replace('+', '') }}
																		</td>
																{% else %}
																		<td style="text-align: center" class="bg-danger">  
																				{{ coluna['Resultado']|replace('+', '') }}
																		</td>
																{% endif %}
														{% elif mercado == 'under3_5' %}
																{% if coluna['SomaGolsUnder3_5'] < 3.5 %}
																		<td style="text-align: center" class="bg-success">  
																				{{ coluna['Resultado']|replace('+', '') }}
																		</td>
																{% else %}
																		<td style="text-align: center" class="bg-danger">  
																				{{ coluna['Resultado']|replace('+', '') }}
																		</td>
																{% endif %}
														{% endif %}
												{% elif mercado.startswith('over') %}
														{% if mercado == 'over0_5' %}
																{% if coluna['SomaGols'] > 0.5 %}
																		<td style="text-align: center" class="bg-success">  
																				{{ coluna['Resultado']|replace('+', '') }}
																		</td>
																{% else %}
																		<td style="text-align: center" class="bg-danger">  
																				{{ coluna['Resultado']|replace('+', '') }}
																		</td>
																{% endif %}
														{% elif mercado == 'over1_5' %}
																{% if coluna['SomaGols'] > 1.5 %}
																		<td style="text-align: center" class="bg-success">  
																				{{ coluna['Resultado']|replace('+', '') }}
																		</td>
																{% else %}
																		<td style="text-align: center" class="bg-danger">  
																				{{ coluna['Resultado']|replace('+', '') }}
																		</td>
																{% endif %}
														{% elif mercado == 'over2_5' %}
																{% if coluna['SomaGols'] > 2.5 %}
																		<td style="text-align: center" class="bg-success">  
																				{{ coluna['Resultado']|replace('+', '') }}
																		</td>
																{% else %}
																		<td style="text-align: center" class="bg-danger">  
																				{{ coluna['Resultado']|replace('+', '') }}
																		</td>
																{% endif %}
														{% elif mercado == 'over3_5' %}
																{% if coluna['SomaGols'] > 3.5 %}
																		<td style="text-align: center" class="bg-success">  
																				{{ coluna['Resultado']|replace('+', '') }}
																		</td>
																{% else %}
																		<td style="text-align: center" class="bg-danger">  
																				{{ coluna['Resultado']|replace('+', '') }}
																		</td>
																{% endif %}
														{% endif %}
												{% elif mercado.startswith('ambas_marcam') %}
														{% if mercado == 'ambas_marcam_sim' %}
																{% if coluna['AmbasMarcam'] %}
																		<td style="text-align: center" class="bg-success">  
																				{{ coluna['Resultado']|replace('+', '') }}
																		</td>
																{% else %}
																		<td style="text-align: center" class="bg-danger">  
																				{{ coluna['Resultado']|replace('+', '') }}
																		</td>
																{% endif %}
														{% elif mercado == 'ambas_marcam_nao' %}
																{% if coluna['AmbasMarcamNao'] %}
																		<td style="text-align: center" class="bg-success">  
																				{{ coluna['Resultado']|replace('+', '') }}
																		</td>
																{% else %}
																		<td style="text-align: center" class="bg-danger">  
																				{{ coluna['Resultado']|replace('+', '') }}
																		</td>
																{% endif %}
														{% endif %}
												{% elif mercado == 'par' %}
														{% if coluna['ParOuImpar'] == 'Par' %}
																<td style="text-align: center" class="bg-success">  
																		{{ coluna['Resultado']|replace('+', '') }}
																</td>
														{% else %}
																<td style="text-align: center" class="bg-danger">  
																		{{ coluna['Resultado']|replace('+', '') }}
																</td>
														{% endif %}
												{% elif mercado == 'impar' %}
														{% if coluna['ParOuImpar'] == 'Ímpar' %}
																<td style="text-align: center" class="bg-success">  
																		{{ coluna['Resultado']|replace('+', '') }}
																</td>
														{% else %}
																<td style="text-align: center" class="bg-danger">  
																		{{ coluna['Resultado']|replace('+', '') }}
																</td>
														{% endif %}
												{% endif %}
										{% endif %}
								{% endfor %}
						</tr>
					{% endfor %}
			</tbody>
	</table>
	{% else %}
		<div class="alert alert-warning" role="alert">
				Nenhum jogo encontrado.
		</div>
	{% endif %}

</div>
<script>
	function updateParams() {
	const mercado = document.getElementById('mercado').value;
	const periodo = document.getElementById('periodo').value;
	const campeonato = document.getElementById('campeonato').value;

	// Armazenar as seleções no localStorage
	localStorage.setItem('mercado', mercado);
	localStorage.setItem('periodo', periodo);
	localStorage.setItem('campeonato', campeonato);

	const url = new URL(window.location.href);
	url.searchParams.set('mercado', mercado);
	url.searchParams.set('periodo', periodo);
	url.searchParams.set('campeonato', campeonato);

	fetch(url)
			.then(response => {
					if (!response.ok) {
							throw new Error('Network response was not ok');
					}
					return response.text();
			})
			.then(html => {
					document.body.innerHTML = html;

					// Restaurar os valores selecionados após a atualização do HTML
					document.getElementById('mercado').value = localStorage.getItem('mercado') || 'over2_5';
					document.getElementById('periodo').value = localStorage.getItem('periodo') || '24';
					document.getElementById('campeonato').value = localStorage.getItem('campeonato') || '1';
			})
			.catch(error => {
					console.error('There has been a problem with your fetch operation:', error);
			});
}

// Quando a página é carregada, restaurar as seleções
window.onload = function() {
	const storedMercado = localStorage.getItem('mercado');
	const storedPeriodo = localStorage.getItem('periodo');
	const storedCampeonato = localStorage.getItem('campeonato');

	if (storedMercado) {
			document.getElementById('mercado').value = storedMercado;
	}
	if (storedPeriodo) {
			document.getElementById('periodo').value = storedPeriodo;
	}
	if (storedCampeonato) {
			document.getElementById('campeonato').value = storedCampeonato;
	}
};

</script>

<script>
	function openModal(){
		const openModalButton = document.getElementById('openModalButton');
		const closeModalButton = document.getElementById('closeModalButton');
		const modal = document.getElementById('ligaModal');

		let storedMercado = document.getElementById('mercado').selectedOptions[0].textContent
		let storedPeriodo = document.getElementById('periodo').value
		let storedCampeonato = document.getElementById('campeonato').value

		document.getElementById('head-busca').innerHTML = `
				Busca Automática - ${storedMercado} - ultimas ${storedPeriodo} horas`

		document.getElementById('leagueId').innerHTML = storedMercado

		modal.style.display = 'block';

		// Fechar o modal ao clicar no "X"
		closeModalButton.addEventListener('click', () => {
			modal.style.display = 'none';
		});

		// Fechar o modal ao clicar fora da caixa do modal
		window.addEventListener('click', (event) => {
			if (event.target === modal) {
				modal.style.display = 'none';
			}
		});
	}
</script>

<style>
	/* Estilos do modal */
.modal {
	display: none; /* Inicialmente oculto */
	position: fixed; /* Fica fixo na tela */
	z-index: 1; /* Coloca o modal acima do conteúdo */
	left: 0;
	top: 0;
	width: 100%; /* 100% da largura da tela */
	height: 100%; /* 100% da altura da tela */
	background-color: rgba(0, 0, 0, 0.4); /* Fundo semitransparente */
}

/* Conteúdo do modal */
.modal-content {
	background-color: #fefefe;
	margin: 15% auto;
	padding: 20px;
	border: 1px solid #888;
	width: 80%; /* Ajuste conforme necessário */
}

/* Botão de fechar (X) */
.close {
	color: #aaa;
	float: right;
	font-size: 28px;
	font-weight: bold;
}

.close:hover,
.close:focus {
	color: black;
	text-decoration: none;
	cursor: pointer;
}

</style>

{% endblock %}
